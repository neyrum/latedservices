{"ast":null,"code":"import api from \"../plugins/axios\";\nexport default {\n  namespaced: true,\n  // Habilitamos el espacio de nombres para este módulo\n  state: {\n    isAuthenticated: !!localStorage.getItem(\"token\"),\n    // Verifica si hay un token guardado\n    userData: null // Información del usuario autenticado\n  },\n  mutations: {\n    // ✅ Cambié el nombre de esta mutación de \"setAuthenticated\" a \"SET_AUTHENTICATED\" para seguir convenciones de Vuex\n    SET_AUTHENTICATED(state, status) {\n      state.isAuthenticated = status;\n    },\n    // Guarda los datos del usuario en el estado\n    setUserData(state, data) {\n      state.userData = data;\n    }\n  },\n  actions: {\n    async login({\n      commit,\n      dispatch\n    }, credentials) {\n      try {\n        const response = await api.post(\"/auth/login\", credentials);\n        const token = response.data.token;\n        localStorage.setItem(\"token\", token);\n        commit(\"SET_AUTHENTICATED\", true);\n        await dispatch(\"fetchUserData\");\n      } catch (error) {\n        console.error(\"Error al iniciar sesión:\", error);\n        throw error.response?.data?.message || \"Error al iniciar sesión.\";\n      }\n    },\n    async fetchUserData({\n      commit\n    }) {\n      try {\n        const response = await api.get(\"/users/me\", {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        commit(\"setUserData\", response.data);\n      } catch (error) {\n        if (error.response?.status === 401) {\n          commit(\"SET_AUTHENTICATED\", false);\n          commit(\"setUserData\", null);\n          localStorage.removeItem(\"token\");\n        }\n        console.error(\"Error al obtener los datos del usuario:\", error);\n      }\n    },\n    // ✅ Aquí agregué `window.location.reload();` para forzar la actualización de la navbar al cerrar sesión\n    logout({\n      commit\n    }) {\n      localStorage.removeItem(\"token\");\n      commit(\"SET_AUTHENTICATED\", false);\n      commit(\"setUserData\", null);\n      window.location.reload(); // Recargar la página después de cerrar sesión\n    },\n    async validateToken({\n      dispatch,\n      commit\n    }) {\n      const token = localStorage.getItem(\"token\");\n      if (!token) {\n        commit(\"SET_AUTHENTICATED\", false);\n        commit(\"setUserData\", null);\n        return;\n      }\n      try {\n        await dispatch(\"fetchUserData\");\n        commit(\"SET_AUTHENTICATED\", true);\n      } catch (error) {\n        console.error(\"Error al validar el token:\", error);\n        commit(\"SET_AUTHENTICATED\", false);\n        commit(\"setUserData\", null);\n        localStorage.removeItem(\"token\");\n      }\n    }\n  },\n  getters: {\n    isAuthenticated: state => state.isAuthenticated,\n    userData: state => state.userData,\n    userRole: state => state.userData ? state.userData.role : undefined\n  }\n};","map":{"version":3,"names":["api","namespaced","state","isAuthenticated","localStorage","getItem","userData","mutations","SET_AUTHENTICATED","status","setUserData","data","actions","login","commit","dispatch","credentials","response","post","token","setItem","error","console","message","fetchUserData","get","headers","Authorization","removeItem","logout","window","location","reload","validateToken","getters","userRole","role","undefined"],"sources":["/home/lated/LatedServices/frontend/src/store/auth.js"],"sourcesContent":["import api from \"../plugins/axios\";\n\nexport default {\n  namespaced: true, // Habilitamos el espacio de nombres para este módulo\n  state: {\n    isAuthenticated: !!localStorage.getItem(\"token\"), // Verifica si hay un token guardado\n    userData: null, // Información del usuario autenticado\n  },\n  mutations: {\n    // ✅ Cambié el nombre de esta mutación de \"setAuthenticated\" a \"SET_AUTHENTICATED\" para seguir convenciones de Vuex\n    SET_AUTHENTICATED(state, status) {\n      state.isAuthenticated = status;\n    },\n    // Guarda los datos del usuario en el estado\n    setUserData(state, data) {\n      state.userData = data;\n    },\n  },\n  actions: {\n    async login({ commit, dispatch }, credentials) {\n      try {\n        const response = await api.post(\"/auth/login\", credentials);\n        const token = response.data.token;\n\n        localStorage.setItem(\"token\", token);\n        commit(\"SET_AUTHENTICATED\", true);\n\n        await dispatch(\"fetchUserData\");\n      } catch (error) {\n        console.error(\"Error al iniciar sesión:\", error);\n        throw error.response?.data?.message || \"Error al iniciar sesión.\";\n      }\n    },\n\n    async fetchUserData({ commit }) {\n      try {\n        const response = await api.get(\"/users/me\", {\n          headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` },\n        });\n        commit(\"setUserData\", response.data);\n      } catch (error) {\n        if (error.response?.status === 401) {\n          commit(\"SET_AUTHENTICATED\", false);\n          commit(\"setUserData\", null);\n          localStorage.removeItem(\"token\");\n        }\n        console.error(\"Error al obtener los datos del usuario:\", error);\n      }\n    },\n\n    // ✅ Aquí agregué `window.location.reload();` para forzar la actualización de la navbar al cerrar sesión\n    logout({ commit }) {\n      localStorage.removeItem(\"token\");\n      commit(\"SET_AUTHENTICATED\", false);\n      commit(\"setUserData\", null);\n\n      window.location.reload(); // Recargar la página después de cerrar sesión\n    },\n\n    async validateToken({ dispatch, commit }) {\n      const token = localStorage.getItem(\"token\");\n      if (!token) {\n        commit(\"SET_AUTHENTICATED\", false);\n        commit(\"setUserData\", null);\n        return;\n      }\n    \n      try {\n        await dispatch(\"fetchUserData\");\n        commit(\"SET_AUTHENTICATED\", true);\n      } catch (error) {\n        console.error(\"Error al validar el token:\", error);\n        commit(\"SET_AUTHENTICATED\", false);\n        commit(\"setUserData\", null);\n        localStorage.removeItem(\"token\");\n      }\n    },\n  },\n  getters: {\n    isAuthenticated: (state) => state.isAuthenticated,\n    userData: (state) => state.userData,\n    userRole: (state) => state.userData ? state.userData.role : undefined,\n  },\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}